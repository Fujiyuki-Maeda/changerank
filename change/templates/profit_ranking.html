<!DOCTYPE html>
<html lang="ja">
<head>
    {% load static %}
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨é–€åˆ¥ ç²—åˆ©ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ¨ç§»</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        h1 { text-align: center; font-size: 1.8rem; margin-bottom: 20px; color: #e67e22; } /* ã‚ªãƒ¬ãƒ³ã‚¸ç³» */
        
        .nav-links { text-align: left; margin-bottom: 20px; }
        .nav-links a { text-decoration: none; color: #6c757d; font-weight: bold; padding: 5px 10px; border-radius: 5px; background: #eee; transition: background 0.3s; }
        .nav-links a:hover { background: #ddd; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå¹´è¡¨å½¢å¼ï¼‰ */
        .table-responsive { overflow-x: auto; }
        .history-table { width: 100%; border-collapse: collapse; min-width: 800px; }
        
        .history-table th, .history-table td { 
            padding: 12px 8px; 
            border: 1px solid #eee; 
            text-align: center;
            font-size: 0.95rem;
            vertical-align: middle;
        }
        
        .history-table th { background: #e67e22; color: white; white-space: nowrap; }
        .history-table th.dept-col { position: sticky; left: 0; z-index: 10; background: #d35400; width: 150px; }
        .history-table td.dept-col { 
            position: sticky; left: 0; z-index: 5; 
            background: #f8f9fa; font-weight: bold; text-align: left; 
            border-right: 2px solid #ddd;
        }

        /* ãƒ©ãƒ³ã‚¯è¡¨ç¤º */
        .rank-num { font-size: 1.1rem; font-weight: bold; display: block; color: #d35400; }
        .rank-1 .rank-num { font-size: 1.3rem; text-shadow: 1px 1px 0px rgba(0,0,0,0.1); }
        
        /* ç²—åˆ©ç‡è¡¨ç¤º */
        .margin-val { font-weight: bold; font-size: 0.85rem; color: #333; display: block; margin: 2px 0; background: #fff3e0; border-radius: 4px; padding: 1px 4px; display: inline-block; }

        /* ã‚®ãƒ£ãƒƒãƒ—æƒ…å ±: ç²—åˆ©é‡‘é¡ã¯å…¨ã¦é»’ã§çµ±ä¸€ */
        .gap-info { font-size: 0.75rem; display: block; margin-top: 2px; white-space: nowrap; color: #111; }
        .gap-up { color: #111; font-weight: normal; }
        .gap-down { color: #111; }
        .gap-same { color: #111; }

        .no-data { color: #ccc; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-links">
        <a href="{% url 'dashboard' %}">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
    </div>

    <h1>ğŸ’° éƒ¨é–€åˆ¥ ç²—åˆ©ç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ¨ç§» ({{ years.0 }} - {{ years|last }})</h1>
    
    {% if error %}
        <p style="color: red; text-align: center; margin-top: 20px;">{{ error }}</p>
    {% else %}
        <form method="get" style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
            <label style="font-weight:bold;">ğŸ“… è¡¨ç¤º:</label>
            <select name="month" style="padding:6px;border-radius:4px;border:1px solid #ccc;">
                {% for val,label in month_choices %}
                    <option value="{{ val }}" {% if val == target_month %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" style="padding:6px 10px;background:#e67e22;color:#fff;border:none;border-radius:6px;">è¡¨ç¤º</button>
        </form>

        <div class="table-responsive">
            <table class="history-table">
                <thead>
                    <tr>
                        <th class="dept-col">éƒ¨é–€å</th>
                        {% for year in years %}
                            <th>{{ year }}å¹´</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in table_data %}
                    <tr>
                        <td class="dept-col">{{ row.name }}</td>
                        {% for cell in row.cells %}
                            <td class="{% if cell.rank == 1 %}rank-1{% endif %}">
                                {% if cell.rank %}
                                    <!-- é †ä½ -->
                                    <span class="rank-num">
                                        {% if cell.rank == 1 %}ğŸ¥‡{% elif cell.rank == 2 %}ğŸ¥ˆ{% elif cell.rank == 3 %}ğŸ¥‰{% else %}{{ cell.rank }}ä½{% endif %}
                                    </span>
                                    
                                    <!-- ç²—åˆ©ç‡ -->
                                    <div><span class="margin-val">{{ cell.margin }}%</span></div>

                                    <!-- ã‚®ãƒ£ãƒƒãƒ—æƒ…å ± -->
                                    <span class="gap-info {{ cell.gap_class }}">
                                        {{ cell.gap_icon }}
                                    </span>
                                {% else %}
                                    <span class="no-data">-</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p style="text-align: right; font-size: 0.8rem; color: #777; margin-top: 10px;">
            â€» æ•°å­—ã¯ã€Œç²—åˆ©ç‡é †ä½ã€ã€‚èƒŒæ™¯è‰²ã®ã¤ã„ãŸæ•°å­—ã¯ã€Œç²—åˆ©ç‡ã€ã€‚<br>
            ä¸‹ã®å°ã•ã„æ–‡å­—ã¯ã€Œç²—åˆ©é‡‘é¡ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒ»å˜ä½ãªã—ï¼‰ã€ã§ã™ã€‚(ä¾‹: 12,345 )
        </p>
    {% endif %}
</div>

</body>
</html>